# graceful

`start_server`対応ウェブサーバ

* GETリクエスト到着後1秒後にレスポンス"Hello"を返す
* シグナルSIGTERMを受け取ると、新たな接続要求受付を止め、処理中のリクエストに対するレスポンスを返したら終了する
    * 終了時に、処理を開始したりクエスト数、処理を完了したリクエスト数を出力

## 起動方法

`start_server --port 8080 --pid-file app.pid -- ./graceful` [スクリプト](./run)

## 再起動方法

`pkill -HUP start_server`


## グレースフル・リスタートの挙動

* kill -HUPしたときの挙動
    * リクエスト中に `kill -HUP` すると、今動いているサーバは接続要求を待つのを止める. 処理中のリクエストに対するレスポンスを返したら終了する
    * この間新しいサーバが接続要求を受け入れ、処理する
* 時刻Tに再起動
    * Tまでに届いたリクエストは古いサーバから、T以降に届いたリクエストは新しいサーバから返るはず


### テストシナリオ

* T=0～10まで毎秒5リクエスト送信、T=5, T=13で再起動する [スクリプト](./client.sh)
    * 古いサーバは25リクエスト、新しいサーバも25リクエスト返すはず